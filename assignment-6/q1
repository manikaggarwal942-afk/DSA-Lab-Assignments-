#include <iostream>
using namespace std;

// ----------------- Doubly Linked List -----------------
struct DLLNode {
    int data;
    DLLNode* prev;
    DLLNode* next;
    DLLNode(int val) : data(val), prev(nullptr), next(nullptr) {}
};

class DoublyLinkedList {
private:
    DLLNode* head;
public:
    DoublyLinkedList() : head(nullptr) {}

    void insertFirst(int data) {
        DLLNode* newNode = new DLLNode(data);
        if (!head) {
            head = newNode;
            return;
        }
        newNode->next = head;
        head->prev = newNode;
        head = newNode;
    }

    void insertLast(int data) {
        DLLNode* newNode = new DLLNode(data);
        if (!head) {
            head = newNode;
            return;
        }
        DLLNode* temp = head;
        while (temp->next)
            temp = temp->next;
        temp->next = newNode;
        newNode->prev = temp;
    }

    bool insertAfter(int target, int data) {
        DLLNode* temp = head;
        while (temp) {
            if (temp->data == target) {
                DLLNode* newNode = new DLLNode(data);
                newNode->next = temp->next;
                newNode->prev = temp;
                if (temp->next)
                    temp->next->prev = newNode;
                temp->next = newNode;
                return true;
            }
            temp = temp->next;
        }
        return false;
    }

    bool insertBefore(int target, int data) {
        DLLNode* temp = head;
        while (temp) {
            if (temp->data == target) {
                DLLNode* newNode = new DLLNode(data);
                newNode->next = temp;
                newNode->prev = temp->prev;
                if (temp->prev)
                    temp->prev->next = newNode;
                else
                    head = newNode;
                temp->prev = newNode;
                return true;
            }
            temp = temp->next;
        }
        return false;
    }

    bool deleteNode(int target) {
        DLLNode* temp = head;
        while (temp) {
            if (temp->data == target) {
                if (temp->prev)
                    temp->prev->next = temp->next;
                else
                    head = temp->next;
                if (temp->next)
                    temp->next->prev = temp->prev;
                delete temp;
                return true;
            }
            temp = temp->next;
        }
        return false;
    }

    bool search(int target) {
        DLLNode* temp = head;
        while (temp) {
            if (temp->data == target)
                return true;
            temp = temp->next;
        }
        return false;
    }

    void display() {
        DLLNode* temp = head;
        while (temp) {
            cout << temp->data << " <-> ";
            temp = temp->next;
        }
        cout << "NULL" << endl;
    }
};

// ----------------- Circular Linked List -----------------
struct CLLNode {
    int data;
    CLLNode* next;
    CLLNode(int val) : data(val), next(nullptr) {}
};

class CircularLinkedList {
private:
    CLLNode* head;
public:
    CircularLinkedList() : head(nullptr) {}

    void insertFirst(int data) {
        CLLNode* newNode = new CLLNode(data);
        if (!head) {
            head = newNode;
            newNode->next = head;
            return;
        }
        CLLNode* temp = head;
        while (temp->next != head)
            temp = temp->next;
        newNode->next = head;
        temp->next = newNode;
        head = newNode;
    }

    void insertLast(int data) {
        CLLNode* newNode = new CLLNode(data);
        if (!head) {
            head = newNode;
            newNode->next = head;
            return;
        }
        CLLNode* temp = head;
        while (temp->next != head)
            temp = temp->next;
        temp->next = newNode;
        newNode->next = head;
    }

    bool insertAfter(int target, int data) {
        if (!head) return false;
        CLLNode* temp = head;
        do {
            if (temp->data == target) {
                CLLNode* newNode = new CLLNode(data);
                newNode->next = temp->next;
                temp->next = newNode;
                return true;
            }
            temp = temp->next;
        } while (temp != head);
        return false;
    }

    bool insertBefore(int target, int data) {
        if (!head) return false;
        CLLNode* temp = head;
        CLLNode* prev = nullptr;
        do {
            if (temp->data == target) {
                CLLNode* newNode = new CLLNode(data);
                newNode->next = temp;
                if (prev)
                    prev->next = newNode;
                else { // inserting before head
                    CLLNode* last = head;
                    while (last->next != head)
                        last = last->next;
                    last->next = newNode;
                    head = newNode;
                }
                return true;
            }
            prev = temp;
            temp = temp->next;
        } while (temp != head);
        return false;
    }

    bool deleteNode(int target) {
        if (!head) return false;
        CLLNode* temp = head;
        CLLNode* prev = nullptr;
        do {
            if (temp->data == target) {
                if (prev)
                    prev->next = temp->next;
                else { // deleting head
                    if (head->next == head) { // only one node
                        delete head;
                        head = nullptr;
                        return true;
                    }
                    CLLNode* last = head;
                    while (last->next != head)
                        last = last->next;
                    head = head->next;
                    last->next = head;
                }
                delete temp;
                return true;
            }
            prev = temp;
            temp = temp->next;
        } while (temp != head);
        return false;
    }

    bool search(int target) {
        if (!head) return false;
        CLLNode* temp = head;
        do {
            if (temp->data == target)
                return true;
            temp = temp->next;
        } while (temp != head);
        return false;
    }

    void display() {
        if (!head) {
            cout << "List is empty\n";
            return;
        }
        CLLNode* temp = head;
        do {
            cout << temp->data << " -> ";
            temp = temp->next;
        } while (temp != head);
        cout << "(head)\n";
    }
};

// ----------------- Main Menu -----------------
int main() {
    DoublyLinkedList dll;
    CircularLinkedList cll;
    int choice, listType, data, target;

    while (true) {
        cout << "\nChoose List Type:\n1. Doubly Linked List\n2. Circular Linked List\n3. Exit\nChoice: ";
        cin >> listType;
        if (listType == 3) break;

        cout << "\nOperations:\n1. Insert First\n2. Insert Last\n3. Insert After\n4. Insert Before\n5. Delete Node\n6. Search Node\n7. Display List\n8. Back to List Selection\nChoice: ";
        cin >> choice;

        if (choice >=1 && choice <=4) {
            cout << "Enter data: ";
            cin >> data;
            if (choice == 3 || choice == 4) {
                cout << "Enter target node: ";
                cin >> target;
            }
        } else if (choice == 5 || choice == 6) {
            cout << "Enter target node: ";
            cin >> target;
        }

        switch(listType) {
            case 1: // DLL
                switch(choice) {
                    case 1: dll.insertFirst(data); break;
                    case 2: dll.insertLast(data); break;
                    case 3: dll.insertAfter(target, data) ? cout<<"Inserted\n":cout<<"Target not found\n"; break;
                    case 4: dll.insertBefore(target, data) ? cout<<"Inserted\n":cout<<"Target not found\n"; break;
                    case 5: dll.deleteNode(target) ? cout<<"Deleted\n":cout<<"Node not found\n"; break;
                    case 6: dll.search(target) ? cout<<"Node found\n":cout<<"Node not found\n"; break;
                    case 7: dll.display(); break;
                }
                break;
            case 2: // CLL
                switch(choice) {
                    case 1: cll.insertFirst(data); break;
                    case 2: cll.insertLast(data); break;
                    case 3: cll.insertAfter(target, data) ? cout<<"Inserted\n":cout<<"Target not found\n"; break;
                    case 4: cll.insertBefore(target, data) ? cout<<"Inserted\n":cout<<"Target not found\n"; break;
                    case 5: cll.deleteNode(target) ? cout<<"Deleted\n":cout<<"Node not found\n"; break;
                    case 6: cll.search(target) ? cout<<"Node found\n":cout<<"Node not found\n"; break;
                    case 7: cll.display(); break;
                }
                break;
        }
    }

    return 0;
}
